{% extends "dashboard.base.html" %}
{% load static %}
{% block styles %}
{% endblock styles %}
{% block content %}
    <div class="card">
        <div class="card-header">
            <i class="fas fa-recycle"  aria-hidden="true"></i> Inserir material de consumo
        </div>
        <div class="card-body">
            <form autocomplete="off" id="form-item">
                {% csrf_token %}
                <input type="hidden" name="type" value="C"/>
                <div class="form-row">
                    <div class="form-group col-md-8">
                        <label>
                            <b>Nome</b>
                        </label>
                        <input class="form-control rounded-0" type="text" name="name"/>
                        <div class="invalid-feedback" for="name"></div>
                    </div>
                    <div class="form-group col-md-4">
                        <label>Marca</label>
                        <input class="form-control rounded-0" type="text" name="brand" id="brand"/>
                        <div class="invalid-feedback" for="brand"></div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label>
                            <b>Descrição</b>
                        </label>
                        <textarea class="form-control rounded-0"
                                  name="description"
                                  id="description"
                                  rows="5"></textarea>
                        <div class="invalid-feedback" for="description"></div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <label>
                            <b>Quantidade</b>
                        </label>
                        <input class="form-control rounded-0"
                               type="number"
                               name="quantity"
                               id="quantity"/>
                        <div class="invalid-feedback" for="quantity"></div>
                    </div>
                    <div class="form-group col-md-3">
                        <label >Data de validade</label>
                        <input class="form-control rounded-0 mb-1"
                               name="expiration"
                               data-mask="00-00-0000"
                               data-toggle="datepicker"
                               required
                               autocomplete="off"
                               maxlength="10"/>
                        <div class="invalid-feedback" for="expiration"></div>
                    </div>
                </div>
                <hr/>
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label>Data de recebimento</label>
                        <input class="form-control rounded-0 mb-1"
                               name="received_at"
                               data-mask="00-00-0000"
                               data-toggle="datepicker"
                               required
                               autocomplete="off"
                               maxlength="10"
                               date-field/>
                        <div class="invalid-feedback" for="received_at"></div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label>Localização</label>
                        <input type="text"
                               class="form-control rounded-0"
                               name="location"
                               placeholder="Localização"
                               required/>
                        <div class="invalid-feedback" for="location"></div>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Quantidade crítica</label>
                        <input type="number"
                               class="form-control rounded-0"
                               name="alert_below"
                               value="50"/>
                        <div class="invalid-feedback" for="alert_below"></div>
                    </div>
                    <div class="form-group col-md-3">
                        <label>Valor de referência</label>
                        <input type="number"
                               class="form-control rounded-0"
                               name="reference"
                               value="250"/>
                        <div class="invalid-feedback" for="reference"></div>
                    </div>
                </div>
                <hr/>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label>Observações</label>
                        <textarea class="form-control rounded-0" name="comments" id="comments" rows="5"></textarea>
                        <div class="invalid-feedback" for="comments"></div>
                    </div>
                </div>
            </form>
        </div>
        <div class="card-footer">
            <div class="text-center">
                <button id="enviar-instancia" class="btn btn-dark rounded-0">Registrar material de consumo</button>
            </div>
        </div>
    </div>
{% endblock content %}
{% block scripts %}
    <script src="{% static 'assets/dashboard/js/ajax_csrf.js' %}"></script>
    <script src="{% static 'assets/dashboard/js/jquery.mask.js' %}"></script>
    <script src="{% static 'assets/js/response.js' %}"></script>
    <script>
        $('[data-toggle="datepicker"]').datepicker({
            format: 'dd-mm-yyyy',
            months: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
            daysMin: ['D', 'S', 'T', 'Q', 'Q', 'S', 'S']
        });


        $("#form-item [name]").change(function() {
            $(this).removeClass("is-invalid");
        });


        $("#enviar-instancia").click(function(e) {
            e.preventDefault();

            let serialized_data = $("#form-item").serializeREST();
            $.ajax({
                type: "POST",
                url: "/api/laboratorio/consumables/",
                dataType: "json",
                data: serialized_data,
                success: function(response) {
                    showMessage("Material cadastrado com sucesso.", "alert-success");
                    $("#form-item").trigger("reset");
                },
                error(response) {
                    $("#form-item").fillErrors(
                        response.responseJSON,
                        message => showMessage(message, "text-danger")
                    );
                }
            })
        });
    </script>
{% endblock scripts %}
